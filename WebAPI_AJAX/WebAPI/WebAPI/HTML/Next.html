<!DOCTYPE html>
<html>
<head>
    <title>Falmingo taxi</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <script src="../../Scripts/jquery-1.10.2.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="../Content/NextStyle.css" rel="stylesheet" />
   
    <script type="text/javascript">

        function getEnumStatus(id) {
            switch (id) {
                case 0: return "Kreirana";
                case 1: return "Formirana";
                case 2: return "Obradjena";
                case 3: return "Prihvacena";
                case 4: return "Otkazana";
                case 5: return "Neuspesna";
                case 6: return "Uspesna";
                case 7: return "Utoku";
            }
        }

        function getEnumTipAutomobila(id) {
            switch (id) {
                case 0: return "Svejedno";
                case 1: return "Putnicki";
                case 2: return "Kombi";

            }
        }
        function getEnumPol(id) {
            switch (id) {
                case 0: return "Zenski";
                case 1: return "Muski";
            }
        }

        $(document).ready(function () {

            $("#map1").hide();
            $("#voznjeNaCekanjuVozac").hide();
            $("#profil").hide();
            $("#korisnik").css("display", "none");
            $("#dispecer").css("display", "none");
            $("#vozac").css("display", "none");
            $("#dugmeIzmeni").hide();
            $('#dodajVozaca').hide();
            $('#promeniLokaciju').hide();
            $('#naruciVoznju').hide();
            $('#dodavanjeKorisnikaDiv').hide();
            $("#dugmeDodajVozaca").hide();
            $("#formiranjeVoznjeDispecer").hide();
            $("#dugmePromeniLokacijuDiv").hide();
            $("#promeniLokacijuDiv").hide();
            $("#naruciVoznjuDiv").hide();
            $("#dugmeNaruciVoznjuDiv").hide();
            $(".dropdown").hide();
            $("#fitriranjeVoznji").hide();
            $("#dispecerPretraga").hide();

            var uloga = '';
            var korisnikovAJDI = '';
            let korisnik1 = "";

            var ime = localStorage.getItem("korisnik");
            $("#NaslovK").text(ime);

            let korisnik = {
                Kime: `${ime}`,
            };
    
            $.ajax({
                type: 'GET',//promeni na GET jer saljes samo korisnicko ime, ne moze zbog karaktera
                url: '/api/Prijava/' + ime,
                data: JSON.stringify(korisnik),
                contentType: 'application/json; charset=utf-8',
                async: false,
                dataType: 'json',
                success: function (data) {
                    korisnikovAJDI = data.Id;
                    korisnik1 = data;
                    uloga = data.Uloga; // 0 korisnik , 1 dispecer , 2 vozac

                    let myVar = setInterval(
                        function proveriStanje() {
                            if (uloga == 0) {//korisnik
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Korisnik/' + korisnikovAJDI,
                                    async: false,
                                    success: function (data) {
                                        if (data.Ban == 1)
                                            $(location).attr('href', 'index.html');
                                    }
                                })
                            } else if (uloga == 2) {//vozac
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Vozac/' + korisnikovAJDI,
                                    async: false,
                                    success: function (data) {
                                        if (data.Ban == 1)
                                            $(location).attr('href', 'index.html');
                                    }
                                })
                            }
                        }, 1000);

                   

                    if (data.uloga == 0) {
                        alert("Musterija logovana");
                        $("#korisnik").css("display", "block");
                        $("#korisnik").css("clear", "both");
                        $("#korisnik").css("position", "sticky");
                        $("#fitriranjeVoznji").show();
                        $('#naruciVoznju').show();
                        //Posalji zahtev za voznjom - da bi se na pocetnoj ispisala lista  // OVDE SAM MENJALA STAVILA SAM UMESTO POST ->GET*******************************
                        $.ajax({
                            type: 'GET',
                            url: '/api/Voznja',
                            success: function (data) {
                                if (data.length != 0) {
                                    let sviPoz = 0;
                                    for (var v in data) {
                                        if (data[v].idKorisnik == korisnik1.Id) {
                                            if (data[v].StatusVoznje == 0 || (data[v].StatusVoznje == 6 && data[v].Komentar.Opis == " ") || data[v].StatusVoznje == 2) {
                                                sviPoz = 1;
                                                break;
                                            }
                                        }
                                    }
                                 
                                    let korisnikoveVoznje = 0;
                                    for (var v in data) {
                                        if (data[v].IdKorisnik == korisnikovAJDI)
                                            korisnikoveVoznje = 1;
                                    }
                                    if (korisnikoveVoznje == 1) {
                                        let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                        tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                        tabelaVoznji += "<th>Komentar</th>";
                                        tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th>"
                                        if (sviPoz == 0) {
                                            tabelaVoznji += `</tr>`;
                                        } else {
                                            tabelaVoznji += "<th colspan =\"2\"></th></tr>";
                                        }
                                        for (voznja in data) {
                                            if (data[voznja].idKorisnik == korisnikovAJDI) {
                                                var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                                var datum =
                                                    currentdate.getUTCFullYear() + "/" +
                                                    ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                                    ("0" + currentdate.getUTCDate()).slice(-2);

                                                var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                                    ("0" + currentdate.getUTCMinutes()).slice(-2);
                                                tabelaVoznji += `<tr>
                                                                        <td>${data[voznja].Id}</td>

                                                                        <td>${korisnik1.ime} ${korisnik1.prezime}</td>`;
                                                if (data[voznja].idVozac != " ") {

                                                    $.ajax({
                                                        type: 'GET',
                                                        url: '/api/Vozac/' + data[voznja].idVozac,
                                                        async: false,
                                                        success: function (data) {
                                                            tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                        }
                                                    })
                                                } else {
                                                    tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                                }

                                                if (data[voznja].idDispecer != " ") {

                                                    $.ajax({
                                                        type: 'GET',
                                                        url: '/api/Dispecer/' + data[voznja].idDispecer,
                                                        async: false,
                                                        success: function (data) {
                                                            tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                        }
                                                    })
                                                } else {
                                                    tabelaVoznji += `<td>${data[voznja].idDispecer}</td>`;
                                                }

                                                tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.adresa.NaseljenoMesto}
                                                                       </td>`;

                                                if (data[voznja].Iznos != "0") {
                                                    tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                                } else {
                                                    tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                                }

                                                if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                    tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                                } else {
                                                    tabelaVoznji += `<td> </td>`;

                                                }

                                                tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                                        `;
                                                if (data[voznja].StatusVoznje == 0) {


                                                    tabelaVoznji += `
                                                                        <td><button id="otkaziVoznju" value="${data[voznja].Id}">Odustani</button></td>
                                                                        <td><button id="izmeniVoznju" value="${data[voznja].Id}">Izmeni</button></td>
                                                                            </tr>`;
                                                }
                                                else if (data[voznja].StatusVoznje == 2) {
                                                    tabelaVoznji += `
                                                                        <td align="center" colspan="2"><button id="izmeniVoznju" value="${data[voznja].Id}">Izmeni</button></td>
                                                                            </tr>`;
                                                }

                                                else if (data[voznja].StatusVoznje == 6 && data[voznja].Komentar.Opis == " ") {
                                                    tabelaVoznji += `
                                                                        <td align="center" colspan="2"><button id="korisnikDodajKomentar" value="${data[voznja].Id}">Dodaj komentar</button></td>
                                                                            </tr>`;

                                                }

                                                else {
                                                    if (sviPoz == 0) {
                                                        tabelaVoznji += `</tr>`;
                                                    } else {
                                                        tabelaVoznji += `
                                                                        <td colspan=\"2\"></td>
                                                                            </tr>`;
                                                    }
                                                }
                                            }
                                        }
                                        tabelaVoznji += "</table>";
                                        $("#tabelaVoznji").html(tabelaVoznji);

                                    } else {
                                        $("#tabelaVoznji").html("<h3 align=\"center\">Nemate voznje</h3>");

                                    }
                                }
                            }
                        })

                    } else if (data.uloga == 1) {
                        alert("Dispecer logovan");
                        $('#dodajVozaca').show();
                        $(".dropdown").show();
                        $("#blokiranje").show();
                        $("#fitriranjeVoznji").show();
                        $("#lala").hide();
                        $("#lala1").hide();
                        $("#lala2").hide();
                        $("#dispecer").css("display", "block");
                        $("#dispecer").css("clear", "both");
                        $("#dispecer").css("position", "sticky");

                        let voznje = [];
                        $.ajax({
                            type: 'GET',
                            url: '/api/Voznja',//ajdidispecera
                            success: function (data) {
                                voznje = data;
                                let imaDispecer = 0;
                                for (voznja in data) {
                                    if (data[voznja].idDispecer == korisnikovAJDI)
                                        imaDispecer = 1;
                                }

                                if (imaDispecer != 1) {
                                    $("#tabelaVoznjiDispecera").html("<h4 align=\"center\">Trenutno nemate ni jenu voznju :)</h4>");

                                } else {

                                    let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";

                                    for (voznja in data) {
                                        if (data[voznja].idDispecer == korisnikovAJDI) {
                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                            var datum =
                                                currentdate.getUTCFullYear() + "/" +
                                                ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                                ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                                ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr>
                                                                        <td>${data[voznja].Id}</td>`;

                                            if (data[voznja].idKorisnik != " ") {


                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idKorisnik}</td>`;
                                            }

                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                            }

                                            tabelaVoznji += `<td>${korisnik1.ime} ${korisnik1.prezime}</td>
                                                                        <td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;

                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>
                                                                        `;

                                        }
                                    }
                                    tabelaVoznji += "</table>";
                                    $("#tabelaVoznjiDispecera").html(tabelaVoznji);


                                }
                                ///ISPIS SVIH VOZNJI
                                if (data.length == 0) {
                                    $("#tabelaVoznjiDispecera").html("<h4 align=\"center\">Trenutno nema voznji u sistemu :)</h4>");

                                } else {

                                    let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";
                                    for (voznja in data) {
                                        var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                        var datum =
                                            currentdate.getUTCFullYear() + "/" +
                                            ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                            ("0" + currentdate.getUTCDate()).slice(-2);

                                        var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                            ("0" + currentdate.getUTCMinutes()).slice(-2);
                                        tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;

                                        if (data[voznja].idKorisnik != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                }
                                            })

                                        } else {
                                            tabelaVoznji += `<td>${data[voznja].idKorisnik}</td>`;
                                        }

                                        if (data[voznja].idVozac != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Vozac/' + data[voznja].idVozac,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                }
                                            })

                                        } else {
                                            tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                        }


                                        if (data[voznja].idDispecer != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Dispecer/' + data[voznja].idDispecer,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                }
                                            })

                                        } else {
                                            tabelaVoznji += `<td>${data[voznja].idDispecer}</td>`;
                                        }

                                        tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.adresa.NaseljenoMesto}
                                                                       </td>`;


                                        if (data[voznja].Iznos != "0") {
                                            tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                        } else {
                                            tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                        }

                                        if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                            tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                        } else {
                                            tabelaVoznji += `<td> </td>`;

                                        }
                                        tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>
                                                                        `;

                                    }
                                    tabelaVoznji += "</table>";
                                    $("#tabelaSvihVoznji").html(tabelaVoznji);
                                }

                            }
                        })
                    }
                    else if (data.uloga == 2) {
                        alert("Vozac logovana");
                        $("#lala").hide();
                        $("#voznjeNaCekanjuVozac").show();

                        $("#lala1").hide();
                        $("#lala2").hide();
                        $('#promeniLokaciju').show();
                        $("#fitriranjeVoznji").show();//dodala , to treba i kod dispecera

                        $("#vozac").css("display", "block");
                        $("#vozac").css("clear", "both");
                        $("#vozac").css("position", "sticky");


                        $.ajax({
                            type: 'GET',
                            url: '/api/Voznja',
                            success: function (data) {

                                let ima = 0;
                                for (voznja in data) {
                                    if (data[voznja].idVozac == korisnikovAJDI)
                                        ima = 1;
                                }

                                if (ima != 1) {
                                    $("#tabelaVoznjiVozaca").html("<h3 align=\"center\">Nemate ni jednu voznju</h3>");
                                } else {

                                    let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th><th colspan =\"2\"></th></tr>";

                                    for (voznja in data) {
                                        if (data[voznja].idVozac == korisnikovAJDI) {

                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                            var datum =
                                                currentdate.getUTCFullYear() + "/" +
                                                ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                                ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                                ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr>
                                                                        <td>${data[voznja].Id}</td>`;

                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idKorisnik}</td>`;
                                            }



                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                            }




                                            if (data[voznja].idDispecer != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Dispecer/' + data[voznja].idDispecer,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idDispecer}</td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.adresa.NaseljenoMesto}
                                                                       </td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;

                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                                        `;

                                            tabelaVoznji += `<td><button value="${data[voznja].Id}" id="neuspesnaDugme">Neuspesna</button></td><td><button value="${data[voznja].Id}" id="uspesnaDugme">Uspesna</button></td></tr>`;
                                        }

                                    }
                                    $("#tabelaVoznjiVozaca").html(tabelaVoznji);
                                }

                                let imaSlob = 0;
                                for (voznja in data) {
                                    if (data[voznja].StatusVoznje == 0)
                                        imaSlob = 1;
                                }

                                if (imaSlob != 1) {
                                    $("#tabelaVoznjiNaCekanju").html("<h4 align=\"center\">Trenutno nema voznji u na cekanju :)</h4>");
                                } else {
                                    let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th><th></th></tr>";

                                    for (voznja in data) {
                                        if (data[voznja].StatusVoznje == 0) {
                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                            var datum =
                                                currentdate.getUTCFullYear() + "/" +
                                                ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                                ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                                ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr>
                                                                        <td>${data[voznja].Id}</td>`;

                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idKorisnik}</td>`;
                                            }



                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                            }




                                            if (data[voznja].idDispecer != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Dispecer/' + data[voznja].idDispecer,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idDispecer}</td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>
                                                                        ${data[voznja].Lokacija.adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.adresa.NaseljenoMesto}
                                                                       </td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;

                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                                        `;
                                            tabelaVoznji += `<td><button value=${data[voznja].Id} id="prihvatiDugme">Prihvati</button></td></tr>`;

                                        }
                                    }

                                    tabelaVoznji += "</table>";
                                    $("#tabelaVoznjiNaCekanju").html(tabelaVoznji);

                                }
                            }
                        })

                    }
                }

            })

        //LINK U MENIJU PROFIL
        $("#korisnikProfil").click(function () {

            var sadrzaj = $("#izmeni").text();

            if ($("#opis").val() == "") {
                alert("Unesite komentar!");
            } else {

                if (sadrzaj == "Promeni informacije") {
                    $("#block").hide();
                    $("#map1").hide();
                    $("#korisnik").css("display", "none");
                    $("#dispecer").css("display", "none");
                    $("#vozac").css("display", "none");
                    $("#tabelaPrikaza").hide();
                    $("#filtriranje").hide();
                    $("#pretraga").hide();
                    $("#tabelaPretraga").hide();

                    $("#naruciVoznjuDiv").hide();
                    $("#dugmeNaruciVoznjuDiv").hide();

                    $('#izmenaPojedinacneVoznjeDiv').hide();
                    $('#neuspesnaVoznjaKomentarDiv').hide();

                    $("#dugmePromeniLokacijuDiv").hide();
                    $("#dugmeDodajVozaca").hide();
                    $("#formiranjeVoznjeDispecer").hide();

                    $("#obradaVoznjeDispecer").hide();

                    $("#odabirVozaca").hide();


                    $('#dodavanjeKorisnikaDiv').hide();
                    $("#promeniLokacijuDiv").hide();
                    $("#pocetna").hide();
                    $("#pocetna1").hide();
                    $('#profil').show(500);
                    let informacije = "<h2 align=\"center\" style=\"color:#1abc9c\">Vasi licni podaci</h2><hr /><br /><table class=\"izmenaTejbl\" id=\"tabelaObicna\" border='1'>";
                    informacije += `
                                           
                                            <tr>
                                                <td>Korisnicko ime:</td>
                                                <td>${korisnik1.Kime}</td>
                                            </tr>
                                            <tr>
                                                <td>lozinka:</td>
                                                <td>${korisnik1.lozinka}</td>
                                            </tr>
                                            <tr>
                                                <td>ime:</td>
                                                <td>${korisnik1.ime}</td>
                                            </tr>
                                            <tr>
                                                <td>prezime:</td>
                                                <td>${korisnik1.prezime}</td>
                                            </tr>
                                             <tr>
                                                <td>Telefon:</td>
                                                <td>${korisnik1.telefon}</td>
                                            </tr>
                                            <tr>
                                                <td>email:</td>
                                                <td>${korisnik1.email}</td>
                                            </tr>
                                                <tr>
                                                <td>JMBG:</td>
                                                <td>${korisnik1.JMBG}</td>
                                            </tr>
                                            <tr>
                                                <td>Pol:</td>
                                                <td>${getEnumPol(korisnik1.Pol)}</td>
                                            </tr>

                                                `;
                    informacije += "</table>";
                    $('#profil').html(informacije);
                    $('#dugmeIzmeni').show(500);
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");

                }
            }

        });
        $("#pocetnaStranica").click(function () {

            if ($("#opis").val() == "") {
                alert("Unesite komentar!");
            } else {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {

                    $(location).attr('href', 'Next.html');

                    if (uloga == 0) {
                        $("#korisnik").css("display", "block");
                        //    $("#korisnik").css("float", "right");
                        $("#korisnik").css("clear", "both");
                        $("#korisnik").css("position", "sticky");
                    } else if (uloga == 1) {
                        $("#dispecer").css("display", "block");

                        //dispecer tabele
                    } else if (uloga == 2) {
                        $("#vozac").css("display", "block");
                    }
                    $("#filtriranje").hide();
                    $("#tabelaPrikaz").hide();
                    $("#naruciVoznjuDiv").hide();
                    $("#dugmeNaruciVoznjuDiv").hide();
                    //  $("#dugmeADDVozaca").hide();
                    $('#dodavanjeKorisnikaDiv').hide();
                    $("#dugmeDodajVozaca").hide();
                    $("#formiranjeVoznjeDispecer").hide();
                    $("#obradaVoznjeDispecer").hide();

                    $("#odabirVozaca").hide();


                    $("#profil").hide();
                    $("#pocetna1").show();
                    $("#pocetna").show();
                    $('#dugmeIzmeni').hide();

                    $("#promeniLokacijuDiv").hide();
                    $("#dugmePromeniLokacijuDiv").hide();
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");

                }
            }


        });
            //sacuvaj
        $("#izmeni").click(function () {
            var sadrzaj = $("#izmeni").text();
            if (sadrzaj == "Promeni informacije") {
                $("#izmeni").text("Sacuvaj");
                $("#dugmeDodajVozaca").hide();
                $("#formiranjeVoznjeDispecer").hide();

                $('#subBut').hide();
                $("#dugmePromeniLokacijuDiv").hide();

                $("#promeniLokacijuDiv").hide();
                $("#dugmePromeniLokacijuDiv").hide();

                $("#naruciVoznjuDiv").hide();
                $("#dugmeNaruciVoznjuDiv").hide();


                $("#tabelaObicna").hide(500);
                let informacije = "<h2 align=\"center\" style=\"color:#1abc9c\">Vasi licni podaci</h2><hr /><br /><table class=\"izmenaTejbl\" id=\"tabelaNeobicna\" border='1'>";
                informacije += ` <tr>
                                                <td>Korisnicko ime:</td>
                                                <td><input type=\"text\" id=\"KimeIzmeni\" value=\"${korisnik1.Kime}\" /></td>
                                            </tr>
                                            <tr>
                                                <td>lozinka:</td>
                                                <td><input type=\"text\" id=\"lozinkaIzmeni\" value=\"${korisnik1.lozinka}\" /></td>
                                            </tr>
                                            <tr>
                                                <td>ime:</td>
                                                <td><input type=\"text\" id=\"imeIzmeni\" value=\"${korisnik1.ime}\" /></td>
                                            </tr>
                                            <tr>
                                                <td>prezime:</td>
                                                <td><input type=\"text\" id=\"prezimeIzmeni\" value=\"${korisnik1.prezime}\" /></td>
                                            </tr>
                                             <tr>
                                                <td>Telefon:</td>
                                                <td><input type=\"text\" id=\"telefonIzmeni\" value=\"${korisnik1.telefon}\" /></td>
                                            </tr>
                                            <tr>
                                                <td>email:</td>
                                                <td><input type=\"text\" id=\"emailIzmeni\" value=\"${korisnik1.email}\" /></td>
                                            </tr>
                                            <tr>
                                                <td>JMBG:</td>
                                                <td>${korisnik1.JMBG}</td>
                                            </tr>
                                            <tr>
                                                <td>Pol:</td>
                                                <td>${getEnumPol(korisnik1.pol)}</td>
                                            </tr>
                                            `;
                informacije += "</table>";
                $('#profil').html(informacije);
            } else {
                //ako je udjeno u to
                $("#izmeni").css("background-color", '');

                let korisnik = {
                    Kime: `${$('#KimeIzmeni').val()}`,
                    lozinka: `${$('#lozinkaIzmeni').val()}`,
                    ime: `${$('#imeIzmeni').val()}`,
                    prezime: `${$('#prezimeIzmeni').val()}`,
                    email: `${$('#emailIzmeni').val()}`,
                    telefon: `${$('#telefonIzmeni').val()}`,
                    uloga: uloga,
                };

                //put da promenis saljes novog i stari id pa get da dobijes

                $.ajax({
                    type: 'PUT',
                    url: '/api/Korisnik/' + korisnik1.Id,
                    data: JSON.stringify(korisnik),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {

                        if (!data) {
                            alert("Zauzeto korisnicko ime!");
                        } else {

                            //get u zavisnosti od uloge.
                            if (uloga == 0) {//get za korisnika

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Korisnik/' + korisnik1.Id,
                                    async: false,
                                    success: function (data) {
                                        korisnik1 = data;
                                    }
                                })


                            } else if (uloga == 2) {

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Vozac/' + korisnik1.Id,
                                    async: false,
                                    success: function (data) {
                                        korisnik1 = data;
                                    }
                                })

                            } else if (uloga == 1) {

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Dispecer/' + korisnik1.Id,
                                    async: false,
                                    success: function (data) {
                                        korisnik1 = data;
                                    }
                                })
                            }

                            $("#izmeni").text("Promeni informacije");

                            localStorage.setItem("korisnik", korisnik1.Kime);
                            var ime = localStorage.getItem("korisnik");
                            $("#NaslovK").text(ime);
                            $("#tabelaNeobicna").hide(500);
                            let informacije = "<h2 align=\"center\" style=\"color:#1abc9c\" >Vasi licni podaci</h2><hr /><br /><table class=\"izmenaTejbl\" id=\"tabelaObicna\" border='1'>";
                            informacije += ` <tr>
                                                <td>Korisnicko ime:</td>
                                                <td>${korisnik1.Kime}</td>
                                            </tr>
                                            <tr>
                                                <td>lozinka:</td>
                                                <td>${korisnik1.lozinka}</td>
                                            </tr>
                                            <tr>
                                                <td>ime:</td>
                                                <td>${korisnik1.ime}</td>
                                            </tr>
                                            <tr>
                                                <td>prezime:</td>
                                                <td>${korisnik1.prezime}</td>
                                            </tr>
                                             <tr>
                                                <td>Telefon:</td>
                                                <td>${korisnik1.telefon}</td>
                                            </tr>
                                            <tr>
                                                <td>email:</td>
                                                <td>${korisnik1.email}</td>
                                            </tr>
                                            <tr>
                                                <td>JMBG:</td>
                                                <td>${korisnik1.JMBG}</td>
                                            </tr>
                                            <tr>
                                                <td>Pol:</td>
                                                <td>${getEnumPol(korisnik1.pol)}</td>
                                            </tr>


                                                `;
                            informacije += "</table>";
                            $('#profil').html(informacije);


                        }
                    }
                })
            }
        });
        //LOGOUT
        $('#odlogovanje').click(function () {
            if ($("#opis").val() == "") {
                alert("Unesite komentar!");
            } else {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {
                    localStorage.setItem("korisnik", "");
                    $(location).attr('href', 'index.html');
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");

                }
            }
        });
        //dodavanje vozaca
        $('#dodajVozaca').click(function () {
            var sadrzaj = $("#izmeni").text();
            if (sadrzaj == "Promeni informacije") {

                $("#dispecer").css("display", "none");
                $("#block").hide();
                $("#map1").show();
                $("#filtriranje").hide();
                $("#tabelaPrikaz").hide();

                $("#pretraga").hide();
                $("#tabelaPretraga").hide();
                $("#dugmeDodajVozaca").show();
                $("#formiranjeVoznjeDispecer").hide();
                $("#odabirVozaca").hide();

                $("#subBut").show();
                $("#profil").hide();
                $("#pocetna1").hide();
                $("#pocetna").hide();
                $('#dugmeIzmeni').hide();
                $("#promeniLokacijuDiv").hide();
                $('#dodavanjeKorisnikaDiv').show();
                $("#promeniLokacijuDiv").hide();
                $("#dugmePromeniLokacijuDiv").hide();
                $("#obradaVoznjeDispecer").hide();

                let informacije = "<h2  align=\"center\" style=\"color:#1abc9c\"  >Unesite podatke za vozaca</h2><hr /><table class=\"izmenaTejbl\" id=\"tabelaVozaca\" border='1'>";
                informacije += `<tr>
                                                        <td>Ime:</td>
                                                        <td><input type=\"text\" id=\"imeVozac\" required /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Prezime:</td>
                                                        <td><input type=\"text\" id=\"prezimeVozac\" required /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Korisnicko ime:</td>
                                                        <td><input type=\"text\" id=\"KimeVozac\" required /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Lozinka:</td>
                                                        <td><input type=\"text\" id=\"lozinkaVozac\" required /></td>
                                                    </tr>
                                                     <tr>
                                                        <td>JMBG:</td>
                                                        <td><input type=\"text\" id=\"jmbgVozac\" required /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Telefon:</td>
                                                        <td><input type=\"text\" id=\"telefonVozac\" required /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Emal:</td>
                                                        <td><input type=\"text\" id=\"emailVozac\" required /></td>
                                                    </tr>

                                                    <tr>
                                                    <td>Pol: </td>
                                                    <td>
                                                        <select name="Pol" id="polVozac">
                                                            <option>
                                                                Zenski
                                                            </option>
                                                            <option>
                                                                Muski
                                                            </option>
                                                        </select>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td>Godiste auta</td>
                                                        <td><input type=\"text\" id=\"godisteAutaVozac\" required /></td>
                                                </tr>

                                                <tr>
                                                    <td>Registracija auta</td>
                                                        <td><input type=\"text\" id=\"registracijaAutaVozac\" required /></td>
                                                </tr>

                                                 <tr>
                                                    <td>Tip auta: </td>
                                                    <td>
                                                        <select name="Tip" id="tipAuta">
                                                            <option>
                                                                Putnicki
                                                            </option>
                                                            <option>
                                                                Kombi
                                                            </option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                        `;

                informacije += "</table>";
                $('#dodavanjeKorisnikaDiv').html(informacije);

            } else {
                alert("Niste sacuvali izmene.");
                $("#izmeni").css("background-color", "#ff4d4d");
            }

        });
        //DODAVANJE VOZAZCA, sta se radi kada se klikne na dugme
        $('#subBut').click(function () {
            //validacija
            let x = document.getElementById("imeVozac");
            let y = document.getElementById("prezimeVozac");
            let ub = document.getElementById("KimeVozac");
            let m = document.getElementById("lozinkaVozac");
            let p = document.getElementById("jmbgVozac");
            let p1 = document.getElementById("telefonVozac");

            let p7 = document.getElementById("godisteAutaVozac");
            let p8 = document.getElementById("registracijaAutaVozac");
            if (!x.checkValidity() || !y.checkValidity() || !ub.checkValidity() || !m.checkValidity() || !p.checkValidity() || !p1.checkValidity() || !p7.checkValidity()) {
                alert("Morate uneti sva polja!");
            } else {



                let vozac = {
                    Kime: `${$('#KimeVozac').val()}`,
                    lozinka: `${$('#lozinkaVozac').val()}`,
                    ime: `${$('#imeVozac').val()}`,
                    prezime: `${$('#prezimeVozac').val()}`,
                    email: `${$('#emailVozac').val()}`,
                    telefon: `${$('#telefonVozac').val()}`,
                    pol: `${$('#polVozac').val()}`,
                    JMBG: `${$('#jmbgVozac').val()}`,
                    Lokacija: `${""}`,
                    automobil: `${""}`,
                };

                let niz = fulAdresa.split(",");

                let lokacija = {
                    x: `${niz[0]}`,
                    y: `${niz[1]}`,
                    adresa: `${""}`,
                };
              

                let adresa = {
                    UlicaBroj: `${niz[2]}`,
                    NaseljenoMesto: `${niz[3]}`,
                    PozivniBrojMesta: `${''}`,///////////////////////////////////mozda si sjebao
                };

                lokacija.adresa = adresa;

                let automobil = {
                    godiste: `${$('#godisteAutaVozac').val()}`,
                    BrRegistracije: `${$('#registracijaAutaVozac').val()}`,
                    tipAuta: `${$('#tipAuta').val()}`,
                };

                vozac.Lokacija = lokacija;
                vozac.Automobil = automobil;

                $.ajax({
                    type: 'POST',
                    url: '/api/Vozac',
                    data: JSON.stringify(vozac),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data)
                            alert("Korisnicko ime zauzeto.")
                        else {
                            alert("Vozac dodat!")
                            $("#pocetna1").show();
                            $("#pocetna").show();
                            $(location).attr('href', 'Next.html');

                            $("#dugmeDodajVozaca").hide();
                            $("#dodavanjeKorisnikaDiv").hide();
                            $("#promeniLokacijuDiv").hide();
                            $("#dugmePromeniLokacijuDiv").hide();
                        }
                    }
                })
            }
        });
            //PROMENI LOKACIJU KOD VOZACA
        $('#promeniLokaciju').click(function () {
            let sadrzaj1 = $("#podaciUspesno").text();
            let sadrzaj2 = $("#dodajKomentar").text();
            if (sadrzaj1 == "OK" || sadrzaj2 == "OK") {
                alert("Pritisite OK");
            } else {
                if ($("#iznosU").val() == "") {
                    alert("Unesite i iznos!");
                } else {
                    if ($("#opis").val() == "") {
                        alert("Unesite komentar!");
                    } else {
                        $("#map1").show();
                        $("#voznjeNaCekanjuVozac").hide();

                        $("#vozac").css("display", "none");

                        let lokacija = '';
                        $.ajax({
                            type: 'GET',
                            url: '/api/Lokacija/' + korisnik1.Id,
                            success: function (data) {
                                lokacija = data;
                                let staraLokacija = `<br />
                                            <details id="staraLokacijaP">
                                                <summary>Stara lokacija</summary>
                                                <p>X: ${lokacija.x}</p>
                                                <p>Y: ${lokacija.y} </p>
                                                <p>Mesto: ${lokacija.adresa.NaseljenoMesto}</p>
                                                <p>Ulica&Broj: ${lokacija.adresa.UlicaBroj}</p>
                                            </details>`;


                                $('#staraLokacija').html(staraLokacija);

                            }
                        })

                        var sadrzaj = $("#izmeni").text();
                        if (sadrzaj == "Promeni informacije") {

                            $("#pocetna1").hide();
                            $("#profil").hide();
                            $("#pocetna").hide();
                            $("#dugmeDodajVozaca").hide();
                            $("#dodavanjeKorisnikaDiv").hide();
                            $("#dugmeIzmeni").hide();
                            $("#tabelaPrikaza").hide();
                            $("#filtriranje").hide();
                            $("#promeniLokacijuDiv").show(500);
                            $("#dugmePromeniLokacijuDiv").show(500);

                            let informacije = "<h3>Nova lokacija</h3><table class=\"izmenaTejbl\" border='1'>";
                            informacije += `  <tr>
                                                    <td>X koorginata</td>
                                                        <td><input type=\"text\" id=\"xPromeni\" required /></td>
                                                </tr>

                                                 <tr>
                                                    <td>Y koorginata</td>
                                                        <td><input type=\"text\" id=\"yPromeni\" required/></td>
                                                </tr>

                                                 <tr>
                                                    <td>Ulica i broj</td>
                                                        <td><input type=\"text\" id=\"ulicaibrojPromeni\" required /></td>
                                                </tr>

                                                <tr>
                                                    <td>Mesto i postanski broj</td>
                                                        <td><input type=\"text\" id=\"mestoPromeni\" required /></td>
                                                </tr>

                                                    `;
                            informacije += "</table>";
                            $.ajax({
                                type: 'GET',
                                url: '/api/Automobil/' + korisnikovAJDI,
                                success: function (data) {
                                    automobil = data;
                                    let stariAuto = `<hr /> 
                                            <details id="stariAuto">
                                                <summary>Podaci o automobilu</summary>
                                                <p>Broj: ${automobil.BrTaksija}</p>
                                                <p>Godiste: ${automobil.godiste}</p>
                                                <p>Registracija: ${automobil.BrRegistracije}</p>
                                                <p>Tip: ${getEnumTipAutomobila(automobil.tipAuta)}</p>
                                            <hr /><h3><b>Promeni podatke</b></h3><table>
                                            <tr><td>Broj auta:</td><td><input type="text" id="brojAuta" required></td></tr>
                                            <tr><td>Godiste auta:</td><td><input type="number" title="2013-2018" min=2013 max=2018 id="godAuta" required></td></tr>
                                            <tr><td>Registracija auta:</td><td><input type="text" pattern="[A-Z]{2}[0-9]{3}[A-Z]{2}" title="ex.NS002PU" id="regAuta" required></td></tr>
                                            <tr><td>Tip auta:</td><td>
                                            <select id="tipAuta">
                                            <option>Putnicki</option><option>Kombi</option>
                                            </select>
                                            </td></tr>
                                            <tr><td></td><td><button id="sacuvajAuto">Sacuvaj</button></td></tr>
                                            </table>
                                            </details><hr />`;
                                    $('#stariAuto').html(stariAuto);
                                }

                            })
                        } else {
                            alert("Niste sacuvali izmene.");
                            $("#izmeni").css("background-color", "#ff4d4d");

                        }
                    }
                }
            }
        });



        $(document).on("click", "#sacuvajAuto", function () {
            let p = document.getElementById("brojAuta");
            let p1 = document.getElementById("godAuta");
            let p2 = document.getElementById("regAuta");

            if (!p.checkValidity() || !p1.checkValidity() || !p2.checkValidity()) {
                alert("Morate uneti sva polja!");
            } else {
                let automobil = {
                    BrTaksija: `${$('#brojAuta').val()}`,
                    BrRegistracije: `${$('#regAuta').val()}`,
                    godiste: `${$('#godAuta').val()}`,
                    tipAuta: `${$('#tipAuta').val()}`,

                };
                //putom menjam
                $.ajax({
                    type: 'PUT',
                    url: '/api/Automobil/' + korisnikovAJDI,
                    data: JSON.stringify(automobil),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Uspesno promenjeno");
                            $(location).attr('href', 'single.html');
                        }

                    }
                })
            }
        });
       //////////////////////////////////////kad se klikne\

        $("#promeniLokacijuBut").click(function () {

            let zauzet = false;
            $.ajax({
                type: 'GET',
                url: '/api/Vozac/' + korisnikovAJDI,
                async: false,
                success: function (data) {
                    if (data.Zauzet == 1)
                        zauzet = true;
                }
            })
            if (!zauzet) {
                let ime = localStorage.getItem("korisnik");

                let niz = fulAdresa.split(",");

                let lokacija = {
                    x: `${niz[0]}`,
                    y: `${niz[1]}`,
                    adresa: `${""}`,
                };

                let adresa = {
                    UlicaBroj: `${niz[2]}`,
                    NaseljenoMesto: `${niz[3]}`,
                    PozivniBrojMesta: `${''}`,
                };

                lokacija.adresa = adresa; //NOVA LOKACIJA

                $.ajax({
                    type: 'PUT',
                    url: '/api/Lokacija/' + korisnik1.Id,
                    data: JSON.stringify(lokacija),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Uspesno promenjena lokacija");
                            $(location).attr('href', 'single.html');
                        }
                    }
                })

            } else {
                alert("U toku voznje ste");
            }
        });
        //LINK U MENIJU NARUCI VOZNJU _ KOD VOZACA
        $('#naruciVoznju').click(function () {
            if ($("#opis").val() == "") {
                alert("Unesite komentar!");
            } else {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {

                    $("#korisnik").css("display", "none");
                    $('#izmenaPojedinacneVoznjeDiv').hide();
                    $("#tabelaPrikaza").hide();
                    $("#filtriranje").hide();
                    $("#map1").show();
                    $("#pocetna1").hide();
                    $("#profil").hide();
                    $("#pocetna").hide();
                    $("#dugmeDodajVozaca").hide();
                    $("#dodavanjeKorisnikaDiv").hide();
                    $("#dugmeIzmeni").hide();
                    $("#promeniLokacijuDiv").hide();
                    $("#dugmePromeniLokacijuDiv").hide();

                    $("#naruciVoznjuDiv").show();//tu dodajem tabelu
                    $("#dugmeNaruciVoznjuDiv").show();


                    let informacije = "<h2 align=\"center\" style=\"color:#1abc9c\">Naruči vožnju</h2><hr /><br /><table class=\"izmenaTejbl\" border='1'>";
                    // Tabela ima objekat voznja + tip auta da se izabere
                    informacije += `   <tr>
                                                    <td>Tip automobila:</td>
                                                        <td>
                                                        <select name="Tip" id="automobilVoznja">
                                                            <option>
                                                                Svejedno
                                                            </option>
                                                            <option>
                                                                Putnicki
                                                            </option>
                                                            <option>
                                                                Kombi
                                                            </option>
                                                        </select>
                                                    </td>
                                                </tr>

                                                    `;
                    informacije += "</table>";
                    $('#naruciVoznjuDiv').html(informacije);
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");
                }
            }
        });
        //KADA SE KLIKNE NA DUGME NARUCI VOZNJU
        $("#naruciVoznjuBut").click(function () {

            let voznja = {
                Lokacija: `${""}`,
                Automobil: `${$('#automobilVoznja').val()}`,
                IdKorisnik: korisnikovAJDI,
                StatusVoznje: 0, // dodala sam taj deo
                idDispecer: " ",
                idVozac: " ",
            };

            let niz = fulAdresa.split(",");

            let lokacija = {
                x: `${niz[0]}`,
                y: `${niz[1]}`,
                adresa: `${""}`,
            };

            let adresa = {
                UlicaBroj: `${niz[2]}`,
                NaseljenoMesto: `${niz[3]}`,
                PozivniBrojMesta: `${''}`,
            };
            lokacija.adresa = adresa;
            voznja.Lokacija = lokacija;

            // OVDE IDE PARSIRANJE VOZNJE I AJAKS!

            $.ajax({
                type: 'POST',
                url: '/api/Voznja',
                data: JSON.stringify(voznja),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        alert("Vasa voznja je narucena ");
                        $(location).attr('href', 'Next.html')
                    }
                }
            })

        });

        var idVoznje = '';
        //OTKAZ VOZNJE KOD KLIJENATA
        $(document).on("click", "#otkaziVoznju", function () {
            idVoznje = $(this).val();
            $('#izmenaPojedinacneVoznjeDiv').show();

            id = $(this).val();
            let voznja = {
                idKorisnik: korisnik1.Id,
                StatusVoznje: 4,
            };

            $.ajax({
                type: 'PUT',
                url: '/api/Voznja/' + id,
                data: JSON.stringify(voznja),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data == false) { alert("Ova voznja ne moze biti otkazana jer je dispacer formirao"); }
                    else {

                        let informacije = "<br />Molim Vas, ostavite komentar<table border='1'>";
                        informacije += `  <tr>
                                                    <td>Opis</td>
                                                        <td><input type=\"text\" id=\"opis\" required/></td>
                                                </tr>


                                                 <tr>
                                                    <td>Ocena:</td>
                                                        <td>
                                                        <select name="Ocena" id="ocena">
                                                            <option>0</option>
                                                            <option>1</option>
                                                            <option>2</option>
                                                            <option>3</option>
                                                            <option>4</option>
                                                            <option>5</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                    <tr>
                                                        <td colspan=\"2\"><button id="dodajKomentar">OK</button></td>
                                                </tr>
                                                    `;
                        informacije += "</table><br />";
                        $('#izmenaPojedinacneVoznjeDiv').html(informacije);

                    }
                }
            })

        });


        $(document).on("click", "#dodajKomentar", function () {
            alert("dodaj kom, posalji ajaxom" + $("#otkaziVoznju").val() + korisnikovAJDI);

            let x = document.getElementById("opis");
            let o = $('#ocena').val();

            if (!x.checkValidity() && o != "0") {
                alert("Morate uneti sva polja!");
            } else {


                let ime = localStorage.getItem("korisnik");
                let komentar = {
                    Opis: `${$('#opis').val()}`,
                    DatumObjave: `${""}`,
                    idKorisnik: ime,
                    idVoznja: idVoznje,
                    Ocena: `${$('#ocena').val()}`,

                };

                let voznja = {
                    Komentar: komentar,
                };

                $.ajax({
                    type: 'POST',
                    url: '/api/Komentar',
                    data: JSON.stringify(komentar),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                })

                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + idVoznje,
                    data: JSON.stringify(voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Uspesno dodeljen komentar voznji");
                            alert("2");
                            $(location).attr('href', 'single.html');
                        } else {
                            alert("Vec je postavljen komentar");
                        }
                    }
                })
            }
        });

            /////////////////////IZMENA VOZNJE
        var voznjaKojaSeMenja = '';
        $(document).on("click", "#izmeniVoznju", function () {
            //ovde ces ajaxom da saljes i da menjas voznje :)
            $("#map1").show();
            //ubaCi odje ajax poziv
            let idVoznje = $(this).val();

            $.ajax({
                type: 'GET',
                url: '/api/Voznja/' + idVoznje,
                success: function (data) {
                    let staro = data;


                    let informacije = "<br />Izmena voznje<table border='1'>";
                    informacije += `  <tr>
                                                    <td>X koorginata</td>
                                                        <td><input type=\"text\" disabled value=\"${staro.Lokacija.x}\"  id=\"xIzmena\" required/></td>
                                                </tr>

                                                 <tr>
                                                    <td>Y koorginata</td>
                                                        <td><input type=\"text\" disabled value=\"${staro.Lokacija.y}\" id=\"yIzmena\" required/></td>
                                                </tr>

                                                 <tr>
                                                    <td>Ulica i broj</td>
                                                        <td><input type=\"text\" disabled value=\"${staro.Lokacija.adresa.UlicaBroj}\" id=\"ulicaibrojIzmena\" required/></td>
                                                </tr>

                                                <tr>
                                                    <td>Mesto</td>
                                                        <td><input type=\"text\" disabled value=\"${staro.Lokacija.adresa.NaseljenoMesto}\" id=\"mestoIzmena\" required/></td>
                                                </tr>

                                              
                                                 <tr>
                                                    <td>Tip automobila:</td>
                                                        <td>
                                                        <select name="Tip" id="automobilIzmena">`;

                    if (staro.Automobil == 0) {
                        informacije += `<option selected>Svejedno</option><option>Putnicki</option><option>Kombi</option></select>`;
                    } else if (staro.Automobil == 1) {
                        informacije += `<option>Svejedno</option><option selected>Putnicki</option><option>Kombi</option></select>`;
                    } else if (staro.Automobil == 2) {
                        informacije += `<option>Svejedno</option><option>Putnicki</option><option selected>Kombi</option></select>`;
                    }

                    informacije += `</td ></tr><tr><td colspan=\"2\"><button id="izmenaVoznjeForma">Sacuvaj izmene</button></td></tr></table><br />`;
                    $('#izmenaPojedinacneVoznjeDiv').show();

                    $('#izmenaPojedinacneVoznjeDiv').html(informacije);

                }
            })
            alert($(this).val() + " voznja se ne menja");
            voznjaKojaSeMenja = $(this).val();
        });

        $(document).on("click", "#izmenaVoznjeForma", function () {

            let ime = localStorage.getItem("korisnik");
            let ajdi = voznjaKojaSeMenja;
            let voznja = {
                Id: ajdi,
                idKorisnik: korisnikovAJDI,
                Automobil: `${$('#automobilIzmena').val()}`,
            };
            let lokacija;
            let adresal
            if (fulAdresa != '') {
                let niz = fulAdresa.split(",");
                lokacija = {
                    x: `${niz[0]}`,
                    y: `${niz[1]}`,
                    adresa: `${""}`,
                };
                adresa = {
                    UlicaBroj: `${niz[2]}`,
                    NaseljenoMesto: `${niz[3]}`,
                    PozivniBrojMesta: `${''}`,
                };
            } else {
                lokacija = {
                    x: `${$('#xIzmena').val()}`,
                    y: `${$('#yIzmena').val()}`,
                    adresa: `${""}`,
                };

                adresa = {
                    UlicaBroj: `${$('#ulicaibrojIzmena').val()}`,
                    NaseljenoMesto: `${$('#mestoIzmena').val()}`,
                    PozivniBrojMesta: `${''}`,
                };
            }

            lokacija.adresa = adresa;
            voznja.lokacija = lokacija; // ovo saljem post metodom

            $.ajax({
                type: 'PUT',
                url: '/api/Voznja/' + ajdi,
                data: JSON.stringify(voznja),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    alert("Uspesna izmena");
                    $(location).attr('href', 'single.html');

                }
            })

        });

       //////////////FORMIRANJE VOZNJE DISPECER
        $(document).on("click", "#formirajVoznjuDugme", function () {
            if (fulAdresa == '') {
                alert("Unesite lokacju!");
            } else {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {
                    alert("Saljem voznju na formiranje");

                    let tipAuta = $('#automobilFormiranje').val();
                    let bitno = true;
                    let imaVozaca = false;
                    if (tipAuta == "Svejedno")
                        bitno = false;

                    let idVozaca;
                    $.ajax({
                        type: 'GET',
                        url: '/api/Vozac',
                        async: false,
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            for (vozac in data) {
                                if (!bitno) {
                                    if (data[vozac].Zauzet == 0) {
                                        imaVozaca = true;
                                        idVozaca = data[vozac].Id;
                                        break;
                                    }
                                } else {
                                    if (data[vozac].Zauzet == 0 && getEnumTipAutomobila(data[vozac].Automobil.tipAuta) == tipAuta) {
                                        imaVozaca = true;
                                        idVozaca = data[vozac].Id;
                                        break;
                                    }
                                }
                            }
                        }
                    })

                    if (imaVozaca == false) {
                        alert("Nema slobodnog vozaca");
                    } else {
                        let vozac = {
                            Zauzet: 1,
                          //  Ban: 2,
                        };

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Vozac/' + idVozaca,
                            data: JSON.stringify(vozac),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data)
                                    alert("Vozac je zauzet sada");
                            }
                        })

                        let voznja = {
                            Lokacija: `${""}`,
                            Automobil: `${$('#automobilFormiranje').val()}`,
                            idDispecer: korisnikovAJDI,
                            StatusVoznje: 1,
                            idKorisnik: " ",
                            idVozac: idVozaca,
                        };

                        let niz = fulAdresa.split(",");

                        let lokacija = {
                            x: `${niz[0]}`,
                            y: `${niz[1]}`,
                            adresa: `${""}`,
                        };

                        let adresa = {
                            UlicaBroj: `${niz[2]}`,
                            NaseljenoMesto: `${niz[3]}`,
                            PozivniBrojMesta: `${''}`,
                        };

                        lokacija.adresa = adresa;
                        voznja.lokacija = lokacija;

                        $.ajax({
                            type: 'POST',
                            url: '/api/Voznja',
                            data: JSON.stringify(voznja),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {
                                    alert("Vasa voznja je formirana :)");
                                    $(location).attr('href', 'Next.html')
                                }
                            }
                        })
                    }
                }
                else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");
                }
            }
        });

        $("#obradiVoznju").click(function () {

            var sadrzaj = $("#izmeni").text();
            if (sadrzaj == "Promeni informacije") {
                alert("Obradjujem voznju");
                $("#tabelaPretraga").hide();
                $("#filtriranje").hide();
                $("#tabelaPrikaz").hide();
                $("#map1").hide();
                $("#odabirVozaca").hide();
                $("#pretraga").hide();
                $("#dispecer").css("display", "none");
                $("#block").hide();
                $("#pocetna1").hide();
                $("#profil").hide();
                $("#pocetna").hide();
                $("#dugmeDodajVozaca").hide();
                $("#dodavanjeKorisnikaDiv").hide();
                $("#dugmeIzmeni").hide();
                $("#obradaVoznjeDispecer").show();
                $("#formiranjeVoznjeDispecer").hide();

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja', // uzimam sve voznje slobodne
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        let have = false;
                        for (var d in data) {
                            if (data[d].StatusVoznje == 0)
                                have = true;
                        }

                        if (have) {
                            let tabelaVoznji = `<h2 align=\"center\" style=\"color:#1abc9c\" >Voznje na cekanju</h2><hr /><table border='1'><tr><th>Musterija</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                            tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th> <th  width=\"200px\"></th></tr>";
                            for (voznja in data) {
                                if (data[voznja].StatusVoznje == 0) {
                                    var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                    var datum =
                                        currentdate.getUTCFullYear() + "/" +
                                        ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                        ("0" + currentdate.getUTCDate()).slice(-2);

                                    var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                        ("0" + currentdate.getUTCMinutes()).slice(-2);


                                    tabelaVoznji += `<tr>`


                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                        async: false,
                                        success: function (data) {
                                            tabelaVoznji += `<td>${data.ime} ${data.prezime}</td>`;
                                        }
                                    })


                                    tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.adresa.NaseljenoMesto}
                                                                       </td>`;





                                    tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                                        <td><button value="${data[voznja].Id}" id="dodavanjeVoznjeVozacu">Dodeli vozacu</button></td>
                                                                        `;

                                }
                            }
                            tabelaVoznji += "</table>";
                            $("#obradaVoznjeDispecer").html(tabelaVoznji);


                        } else {
                            let info = `<h3>Nema voznji na cekanju</h3><hr />`;
                            $("#obradaVoznjeDispecer").html(info);
                        }
                    }
                })
            } else {
                alert("Niste sacuvali izmene.");
                $("#izmeni").css("background-color", "#ff4d4d");

            }
        });
         ////////////////////////dodavanje voznje
        let odabranaVoznja = '';
        $(document).on("click", "#dodavanjeVoznjeVozacu", function () {
            odabranaVoznja = $(this).val();
            alert("Saljem voznju" + odabranaVoznja + "..treba da se otovori lista slobodnih vozaca");

            let voznja = {};
            let bul = 0;//0 /1
            //otvaram listu slobodnih vozaca sa dugmencetom dodaj ga , imace ime, prezime, lokaciju i tip auta
            //get metoda koja mi vraca slobodne vozace
            //get metoda treba da vrati sve vozace, i od njih trazis slobodnog i stavljas u listu, a odabrana voznja se vraca preko Voznje get id

            $.ajax({
                type: 'GET',
                url: '/api/Voznja/' + odabranaVoznja,
                async: false,
                success: function (data) {
                    voznja = data;
                }
            })

            if (voznja.Automobil == 0) // svejedno
                bul = 1;

            let dolaznaAdresa = voznja.Lokacija;

            $.ajax({
                type: 'GET',
                url: '/api/Vozac',
                contentType: 'application/json; charset=utf-8',
                async: false,
                success: function (data) {
                    let data1 = [];
                    for (var vozac in data) {
                        if (bul == 0) {//bitan je auto
                            if (voznja.Automobil == data[vozac].Automobil.tipAuta && data[vozac].Zauzet == 0) { // ako se slazu tipovi auta i ako je slobodan
                                data1.push(data[vozac]);
                            }
                        } else {
                            if (data[vozac].Zauzet == 0) { // ako se slazu tipovi auta i ako je slobodan
                                data1.push(data[vozac]);
                            }
                        }
                    }

                    data = data1;//tu su mi odgovarajuci

                    if (data.length != 0) {
                        alert("Ima vozaca slobodnih");
                        $("#odabirVozaca").show();
                        let petNajblizih = [];

                        if (data.length > 5) {

                            for (var vozac in data) {
                                // c = √ ((xA − xB) ² + (yA − yB) ² )
                                let rastojanje;
                                rastojanje = Math.sqrt(Math.pow(dolaznaAdresa.x - data[vozac].Lokacija.x, 2) + Math.pow(dolaznaAdresa.y - data[vozac].Lokacija.y, 2));

                                let vozac1 = {
                                    Id: data[vozac].Id,
                                    Rastojanje: rastojanje,
                                }
                                petNajblizih.push(vozac1);
                            }


                            petNajblizih.sort(function (a, b) {
                                return a.Rastojanje - b.Rastojanje;
                            })
                            let petOnly = [];

                            for (var pet in petNajblizih) {
                                for (var vozac in data) {
                                    if (data[vozac].Id == petNajblizih[pet].Id) {
                                        petOnly.push(data[vozac]);
                                    }

                                }
                            }

                            data = petOnly; // xD
                        }
                        let tabelaVoznji = `<br /><hr /><h3  align=\"left\" style=\"color:#1abc9c\" >Izaberi vozaca</h3><hr /><table border='1'><tr><th>Ime</th><th>Prezime</th><th>Lokacija</th>`;
                        tabelaVoznji += "<th>Tip automobila</th><th></th></tr>";
                        for (var vozac in data) {

                            tabelaVoznji += `<tr>

                                                                        <td>${data[vozac].ime}</td>
                                                                        <td>${data[vozac].prezime}
                                                                       </td>

                                                                        <td>
                                                                        ${data[vozac].Lokacija.adresa.UlicaBroj},
                                                                       ${data[vozac].Lokacija.adresa.NaseljenoMesto}
                                                                       </td>`;


                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[vozac].Automobil.tipAuta)}</td>
                                                                        <td><button value="${data[vozac].Id}" id="dodavanjeVozacaVoznji">Izaberi</button></td>
                                                                        `;
                            if (vozac == 4)
                                break;
                        }
                        tabelaVoznji += "</table>";
                        $("#odabirVozaca").html(tabelaVoznji);


                    } else {
                        $("#odabirVozaca").show();

                        $("#odabirVozaca").html("<h4>Nema slobodnih vozaca</h4>");
                    }
                }
            })
        });
            /////////////dugme izaberi kad dispicer dodeljuje  voznju
        $(document).on("click", "#dodavanjeVozacaVoznji", function () {
            let vozacId = $(this).val();
            //putom  cu da posaljem id voznje i vozaca i onda ce vozacu da se promeni zauzetost a voznji da se doda vozac i dispecer
            //put da je vozac zauzet
            //get - da dobijes automobil od vozaca
            //put voznju-nadjes sa tim id-jom i stavim joj id vozaca id dispecera i tip auta i status na obradjena

            let vozac = {
                Zauzet: 1,
            //    Ban: 2,
            };

            $.ajax({
                type: 'PUT',
                url: '/api/Vozac/' + vozacId,
                data: JSON.stringify(vozac),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data)
                        alert("Vozac je zauzet sada");
                }
            })

            let autic;
            $.ajax({
                type: 'GET',
                url: '/api/Vozac/' + vozacId,
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    autic = data.Automobil.Tip;
                }
            })


            let voznja = {
                idDispecer: korisnikovAJDI,
                idVozac: vozacId,
                Id: odabranaVoznja,
                StatusVoznje: 2,
                Automobil: autic,
            };

            $.ajax({
                type: 'PUT',
                url: '/api/Voznja/' + odabranaVoznja,
                data: JSON.stringify(voznja),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        alert("Vasa voznja je formirana :)");
                        $(location).attr('href', 'index.html')
                    }
                }
            })

        });
       /////////////ako je neuspesna voznja
        $(document).on("click", "#neuspesnaDugme", function () {

            $('#neuspesnaVoznjaKomentarDiv').show(500);

            id = $(this).val() + ";" + korisnikovAJDI;
            idVoznje = $(this).val();

            let voznja = {
                idVozac: korisnikovAJDI,
                StatusVoznje: 5,
            };

            $.ajax({
                type: 'PUT',
                url: '/api/Voznja/' + idVoznje,
                data: JSON.stringify(voznja),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        let vozac = {
                            Zauzet: 0,
                        //    Ban: 2,
                        };

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Vozac/' + korisnikovAJDI,
                            data: JSON.stringify(vozac),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data == false) { }
                                else {
                                    $(':button').prop('disabled', true);
                                    let informacije = "<br />Molim Vas, ostavite komentar<table border='1'>";

                                    informacije += `  <tr>
                                                            <td>Opis</td>
                                                                <td><input type=\"text\" id=\"opis\" required/></td>
                                                        </tr>
                                                         <tr>
                                                            <td>Ocena:</td>
                                                                <td>
                                                                <select name="Ocena" id="ocena">
                                                                    <option>0</option>
                                                                    <option>1</option>
                                                                    <option>2</option>
                                                                    <option>3</option>
                                                                    <option>4</option>
                                                                    <option>5</option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                            <tr>
                                                                <td colspan=\"2\"><button id="dodajKomentar">OK</button></td>
                                                        </tr>
                                                            `;
                                    informacije += "</table><br />";
                                    $('#neuspesnaVoznjaKomentarDiv').html(informacije);

                                }
                            }
                        })

                    } else {
                        alert("Voznja je vec u stanju neuspesna/uspesna");
                    }
                }
            })

        });


        
        });

    </script>


</head >
<body>

<nav class="navbar navbar-default" id="naki">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" id="korisnikProfil" href="#"><p id="NaslovK"></p></a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav navbar-right">
                <li><a id="pocetnaStranica" href="#">POCETNA</a></li>
                <li><button class="navbar-toggle, dropbtn" id="dispecerPretraga"><i class="fa fa-search" style="font-size:20px"></i></button></li>
                <li><a id="dodajVozaca" href="#">DODAJ VOZACA</a></li>
                <li>
                    <div class="dropdown">
                        <button class="navbar-toggle, dropbtn">
                            <i class="fas fa-car" id="maja" style="font-size:20px"></i>
                        </button>
                        <div class="dropdown-content">
                            <a id="formirajVoznju" href="#">FORMIRAJ VOZNJU</a>
                            <a id="obradiVoznju" href="#">OBRADI VOZNJU</a>
                        </div>
                    </div>
                </li>
                <li><a id="naruciVoznju" href="#">NARUCI VOZNJU</a></li>
                <li><button class="navbar-toggle, dropbtn" id="fitriranjeVoznji"><i class="fa fa-search" style="font-size:20px"></i></button></li>
                <li><a id="promeniLokaciju" href="#">PROMENI LOKACIJU I AUTO</a></li>
                <li><button class="navbar-toggle, dropbtn" id="blokiranje"><i class="fa fa-ban" style="font-size:20px"></i></button></li>
                <li><a id="odlogovanje" href="#">ODJAVI SE</a></li>
            </ul>
        </div>
    </div>
</nav>
<div id="filtriranje">
</div>
<div id="tabelaPrikaza" style="margin-left:10px;"></div>
<div id="pretraga">
</div>
<div id="tabelaPretraga" style="margin-left:200px;"></div>
<div id="block">
</div>

<!-- First Container -->
<div id="pocetna1" class="container-fluid bg-1 text-center">
    <h2 class="margin" style="color:white;font-weight:bold;">DOBRO DOŠLI!</h2><hr />
 
    <h3 id="lala" style="font-size:24px">Brojevi</h3>
    <h3 id="lala1" style="color:#ef5077;font-weight:bold">064 309 3116 &emsp;  <a href="#" id="broj"><i style="font-size:24px" class="fa">&#xf095;</i></a></h3>
    <h3 id="lala2" style="color:#ef5077;font-weight:bold">035 8470 027 &emsp; <a href="#" id="brojHome"><i style="font-size:24px" class="fa">&#xf095;</i></a></h3>
</div>
<!-- Second Container -->

<div id="profil" style="width:800px; margin:0 auto;">
</div>


<div id="korisnik" style="margin-left:5px;">
    <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Sve voznje </h3>
    <hr />
    <div id="tabelaVoznji">
    </div>
    <hr />
    <div id="izmenaPojedinacneVoznjeDiv">
    </div>
</div>
<div id="dispecer" style="margin-left:5px;">
    <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Vase voznje</h3>
    <hr />
    <div id="tabelaVoznjiDispecera">
    </div>
    <hr />
    <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Sve voznje u sistemu </h3>
    <hr />
    <div id="tabelaSvihVoznji">
    </div>
    <hr />
</div>

<div id="vozac" style="margin-left:5px;">
    <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Vase voznje</h3>
    <hr />
    <div id="tabelaVoznjiVozaca">
    </div>
    <hr />
    <div id="neuspesnaVoznjaKomentarDiv">
    </div>

</div>

<div id="dodavanjeKorisnikaDiv" style="width:800px; margin:0 auto;">
</div>
<div id="dugmeDodajVozaca" style="width:800px; margin:0 auto;">
    <br />
    <button class="dugmeSrc" id="subBut">Dodaj vozaca</button>
</div>
<div id="formiranjeVoznjeDispecer" style="width:800px; margin:0 auto;">
</div>
<div id="map1">
    <br /><h3 style="margin-left:800px ">Odaberi lokaciju:</h3>
    <div id="map" class="map" style="width:500px;height:500px;margin-left:800px "></div>
</div>
<div id="voznjeNaCekanjuVozac" style="margin-left:5px;">
    <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Sve voznje koje su na cekanju </h3>
    <hr />
    <div id="tabelaVoznjiNaCekanju">
    </div>
    <hr />
</div>

<div id="obradaVoznjeDispecer" style="width:800px; margin:0 auto;">
</div>
<div id="odabirVozaca" style="width:800px; margin:0 auto;">
</div>

<div id="dugmeIzmeni" style="width:800px; margin:0 auto;">
    <br />
    <button class="dugmeSrc" id="izmeni">Promeni informacije</button><br />
</div>



<div id="promeniLokacijuDiv" style="width:800px; margin:0 auto;">
    <div id="staraLokacija" style="margin-left:5px;"></div>

    <div id="tabelaIzmeniLokaciju"></div>
    <div id="dugmePromeniLokacijuDiv" style="width:800px; margin:0 auto;">
        <br />  <button class="dugmeSrc" id="promeniLokacijuBut">Promeni</button>
    </div>
    <div id="stariAuto" style="margin-left:5px;"></div>
    <div id="tabelaIzmeniAuto"></div>
</div>


<div id="naruciVoznjuDiv" style="width:800px; margin:0 auto;">
</div>
<div id="dugmeNaruciVoznjuDiv" style="width:800px; margin:0 auto;">
    <br /> <button class="dugmeSrc" id="naruciVoznjuBut">Naruci</button>
</div>


<div id="pocetna" class="container-fluid bg-2 text-center">
    <a href="#" class="btn btn-default btn-lg">
        <span class="glyphicon glyphicon-search"></span> Pretrazi sajt
    </a>
</div>
<br />
<footer class="container-fluid bg-4 text-center">
</footer>

<script>
        function myMap() {
            var mapCanvas = document.getElementById("map");
            var myCenter = new google.maps.LatLng(45.242630873254775, 19.842914435055945);
            var mapOptions = { center: myCenter, zoom: 18 };
            var map = new google.maps.Map(mapCanvas, mapOptions);
            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(map, event.latLng);
            });
        }

        let fulAdresa = '';

        function placeMarker(map, location) {
            var marker = new google.maps.Marker({
                position: location,
                map: map
            });

            var fullAdresa = displayLocation(location.lat(), location.lng());

            var delovi = fullAdresa.split(",");
            var ulicaIbroj = delovi[0];
            var grad = delovi[1];//sa zipom
            var drzava = delovi[2];
            fulAdresa = location.lat() + "," + location.lng() + "," + ulicaIbroj + "," + grad + "," + drzava;

            var infowindow = new google.maps.InfoWindow({
                content: 'Latitude: ' + location.lat() + '<br>Longitude: ' + location.lng() + '<br>Ulica i broj: ' + ulicaIbroj + '<br>Grad: ' + grad + '<br>Drzava: ' + drzava + '<br>=' + displayLocation(location.lat(), location.lng())

            });
            infowindow.open(map, marker);
        }


        function displayLocation(latitude, longitude) {
            var request = new XMLHttpRequest();

            var method = 'GET';
            var url = 'http://maps.googleapis.com/maps/api/geocode/json?latlng='
                + latitude + ',' + longitude + '&sensor=true';
            var async = false;
            var address;
            request.open(method, url, async);
            request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {
                    var data = JSON.parse(request.responseText);
                    address = data.results[0];
                    var value = address.formatted_address.split(",");
                    count = value.length;
                    country = value[count - 1];
                    state = value[count - 2];
                    city = value[count - 3];
                }
            };
            request.send();
            return address.formatted_address;
        };

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBrjeABCsOwW1rhi7eW6_b_fWF8OK2HeiA&callback=myMap"></script>

</body>
</html>